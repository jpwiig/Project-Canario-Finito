global  
    debug

defaults
    timeout connect 10s
    timeout client 30s
    timeout server 30s
    log global
    mode http

frontend http-in 
   mode http 
   bind *:80 
   option httplog 
   acl is_cookie_hack_1 hdr_sub(cookie) access_svr=svrblue 
   acl is_cookie_hack_2 hdr_sub(cookie) access_svr=svrgreen 
   use_backend blue_host_http if is_cookie_hack_1 
   use_backend green_host_http if is_cookie_hack_2 
   default_backend webservers_http 

listen stats
    bind *:8404
    stats enable
    stats uri /monitor
    stats refresh 5s

backend featureflag
    bind localhost:3000
    mode http
    server a localhost:9090 cookie svrblue weight {{ a | 50 }} check 
    server  b localhost:8080 cookie svrgreen weight {{ b | 50 }} check

service a
    bind localhost:8080
    balanace roundrobin
    server a_app 
service b
    bind localhost:9090
    balanace roundrobin
    server b_app
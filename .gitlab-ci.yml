stages: 
  - cleanup
  - test
  - build
  - stage-release
  - release

cleanup-job:
  stage: cleanup
  image: docker:latest
  script:
    - echo "cleanup"
    - docker system prune -a -f
test: 
  stage: test
  #image: omcr.cs.oslomet.no:443/s364697/project-canario/accessability
  script:
  - echo "$CI_REGISTRY_PASSWORD" | docker login omcr.cs.oslomet.no:443 -u "$CI_REGISTRY_USER" --password-stdin
  - echo "testing things"
  - ls
  - ./test-script.sh web-1/index.html 8 
  - ./test-script.sh web-2/index.html 10

build-job: 
  stage: build
  # image: docker:latest
  script:
    - echo "building and pushing images"
    - docker system prune -a -f
    - echo "$CI_REGISTRY_PASSWORD" | docker login omcr.cs.oslomet.no:443 -u "$CI_REGISTRY_USER" --password-stdin
    #   - docker login omcr.cs.oslomet.no:443
    - docker build -t omcr.cs.oslomet.no:443/s364697/project-canario/web-2:latest web-2/
    - docker build -t omcr.cs.oslomet.no:443/s364697/project-canario/web-1:latest web-1/
    - docker push omcr.cs.oslomet.no:443/s364697/project-canario/web-1:latest
    - docker push omcr.cs.oslomet.no:443/s364697/project-canario/web-2:latest


stage-release-job:
  stage: stage-release
  image: node:latest
  script:
  - echo "staging"

release-job: 
  stage: release
  image: ubuntu:latest
  script: 
  - echo "realeasing"
